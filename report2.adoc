= i483 最終レポート

== 採用した技術

* ESP32上のプログラムにRust/esp-idf-svcを採用
* ストリーム処理にSparkとScalaを採用 
    ** SparkではDStreamで，構造化ストリーミングは利用しない
* 課題2のMQTTクライアントに rumqttc を採用(https://docs.rs/rumqttc/latest/rumqttc/)

== データサンプル

GrafanaよりSCD41の湿度データをダウンロード

    "time","root.devdb.i483.sensors.s2510030.SCD41.humidity response","root.devdb.i483.sensors.s2510030.analytics.SCD41.humidity.avg response","root.devdb.i483.sensors.s2510030.analytics.SCD41.humidity.max response","root.devdb.i483.sensors.s2510030.analytics.SCD41.humidity.min response"
    2025-06-05 14:10:12,,73.6,,
    2025-06-05 14:10:12,,,73.6,
    2025-06-05 14:10:13,,,,73.6
    2025-06-05 14:10:17,73.4,,,
    2025-06-05 14:10:33,73.4,,,
    2025-06-05 14:10:37,,73.5,,
    2025-06-05 14:10:37,,,73.6,
    2025-06-05 14:10:37,,,,73.4
    2025-06-05 14:10:48,73.4,,,
    2025-06-05 14:11:03,73.4,,,
    2025-06-05 14:11:08,,73.4,,
    2025-06-05 14:11:08,,,73.6,
    2025-06-05 14:11:08,,,,73.4

== 残っている問題点

=== 分かっているバグ

* sparkのcheckpointを/tmpに保存したため，no space left in deviceで落ちる
* threshold detectionをactuator以下に公開していないため，LED点灯が動作していない

=== 未実装

* 課題3.1b,3.2d,3.3b

== 3.2e

各タイムスライスの平均値・最大値・最小値を取得しているため，実データのグラフに追従する形でアグリゲーションの結果が現れている．

== 3.3a

co2の変化率を監視して，人が入室したタイミングを検出する．
自室のデータを見ると入室したタイミングで約20分で150〜200程度の変化が発生するため(e.g. co2 2025-06-05 11:26周辺)，ウィンドウ幅20分のスライディングウィンドウで最大値と最小値の差が150程度の閾値をまたいだ際に入室を検出するシステムが考えられる．

    co2-data-2025-06-05 16_57_29.csv
    2025-06-05 11:26:41,1306
    2025-06-05 11:26:56,1311
    2025-06-05 11:27:11,1314
    2025-06-05 11:27:26,1314
    2025-06-05 11:27:42,1314
    2025-06-05 11:27:57,1315
    2025-06-05 11:28:12,1316
    2025-06-05 11:28:28,1319
    2025-06-05 11:28:43,1317
    2025-06-05 11:28:58,1310
    2025-06-05 11:29:13,1294
    2025-06-05 11:29:28,1280
    2025-06-05 11:29:43,1276
    2025-06-05 11:29:59,1277
    2025-06-05 11:30:14,1276
    2025-06-05 11:30:29,1276
    2025-06-05 11:30:44,1279
    2025-06-05 11:31:00,1283
    2025-06-05 11:31:19,1285
    2025-06-05 11:31:30,1285
    2025-06-05 11:31:45,1285
    2025-06-05 11:32:00,1286
    2025-06-05 11:32:16,1288
    2025-06-05 11:32:31,1290
    2025-06-05 11:32:46,1290
    2025-06-05 11:33:01,1289
    2025-06-05 11:33:17,1289
    2025-06-05 11:33:32,1289
    2025-06-05 11:33:47,1290
    2025-06-05 11:34:02,1290
    2025-06-05 11:34:17,1289
    2025-06-05 11:34:33,1288
    2025-06-05 11:34:48,1288
    2025-06-05 11:35:03,1287
    2025-06-05 11:35:18,1287
    2025-06-05 11:35:34,1286
    2025-06-05 11:35:49,1284
    2025-06-05 11:36:04,1281
    2025-06-05 11:36:19,1280
    2025-06-05 11:36:34,1278
    2025-06-05 11:36:50,1278
    2025-06-05 11:37:05,1277
    2025-06-05 11:37:20,1275
    2025-06-05 11:37:35,1274
    2025-06-05 11:37:51,1272
    2025-06-05 11:38:06,1271
    2025-06-05 11:38:21,1271
    2025-06-05 11:38:36,1268
    2025-06-05 11:38:51,1266
    2025-06-05 11:39:07,1263
    2025-06-05 11:39:22,1261
    2025-06-05 11:39:37,1261
    2025-06-05 11:39:52,1260
    2025-06-05 11:40:07,1259
    2025-06-05 11:40:23,1259
    2025-06-05 11:40:38,1258
    2025-06-05 11:40:53,1258
    2025-06-05 11:41:08,1257
    2025-06-05 11:41:24,1255
    2025-06-05 11:41:39,1254
    2025-06-05 11:41:54,1252
    2025-06-05 11:42:09,1252
    2025-06-05 11:42:24,1251
    2025-06-05 11:42:40,1251
    2025-06-05 11:42:55,1250
    2025-06-05 11:43:10,1250
    2025-06-05 11:43:25,1249
    2025-06-05 11:43:41,1247
    2025-06-05 11:43:56,1246
    2025-06-05 11:44:11,1247
    2025-06-05 11:44:26,1246
    2025-06-05 11:44:41,1244
    2025-06-05 11:44:57,1240
    2025-06-05 11:45:12,1240
    2025-06-05 11:45:27,1238
    2025-06-05 11:45:42,1238
    2025-06-05 11:45:58,1238
    2025-06-05 11:46:13,1239
    2025-06-05 11:46:28,1237
    2025-06-05 11:46:43,1237
    2025-06-05 11:46:58,1237
